<div class="cover">
  <div class="reset-password-container" fxLayoutAlign="center center">
    <mat-card class="reset-password-card">
      <mat-card-header>
        <mat-card-title>
          <div class="title-container" fxLayout="row" fxLayoutAlign="center center">
            <mat-icon class="title-icon">lock_reset</mat-icon>
            <span>Reset Password</span>
          </div>
        </mat-card-title>
        <mat-card-subtitle>
          Enter your credentials and new password to reset your account
        </mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <form [formGroup]="resetPasswordForm" (ngSubmit)="resetPassword()" class="reset-password-form">
          
          <!-- Email Field -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Email Address</mat-label>
            <input matInput 
                   formControlName="email" 
                   type="email" 
                   placeholder="Enter your email address"
                   autocomplete="email">
            <mat-icon matSuffix>email</mat-icon>
            <mat-error *ngIf="resetPasswordForm.get('email')?.hasError('required')">
              Email is required
            </mat-error>
            <mat-error *ngIf="resetPasswordForm.get('email')?.hasError('email')">
              Please enter a valid email address
            </mat-error>
          </mat-form-field>

          <!-- Username Field -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Username</mat-label>
            <input matInput 
                   formControlName="username" 
                   type="text" 
                   placeholder="Enter your username"
                   autocomplete="username">
            <mat-icon matSuffix>person</mat-icon>
            <mat-error *ngIf="resetPasswordForm.get('username')?.hasError('required')">
              Username is required
            </mat-error>
            <mat-error *ngIf="resetPasswordForm.get('username')?.hasError('minlength')">
              Username must be at least 3 characters
            </mat-error>
          </mat-form-field>

          <!-- New Password Field -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>New Password</mat-label>
            <input matInput 
                   formControlName="newPassword" 
                   [type]="passwordInputType" 
                   placeholder="Enter your new password"
                   autocomplete="new-password">
            <mat-icon matSuffix 
                      (click)="togglePasswordVisibility()" 
                      class="password-toggle-icon">
              {{ passwordInputType === 'password' ? 'visibility' : 'visibility_off' }}
            </mat-icon>
            <mat-error *ngIf="resetPasswordForm.get('newPassword')?.hasError('required')">
              New password is required
            </mat-error>
            <mat-error *ngIf="resetPasswordForm.get('newPassword')?.hasError('minlength')">
              Password must be at least 8 characters
            </mat-error>
            <mat-error *ngIf="resetPasswordForm.get('newPassword')?.hasError('pattern')">
              Password must contain uppercase, lowercase, number, and special character
            </mat-error>
          </mat-form-field>

          <!-- Password Strength Indicator -->
          <div class="password-strength" *ngIf="resetPasswordForm.get('newPassword')?.value">
            <div class="strength-bar">
              <div class="strength-fill" 
                   [style.width.%]="getPasswordStrength().percentage"
                   [style.background-color]="getPasswordStrength().color">
              </div>
            </div>
            <span class="strength-text" [style.color]="getPasswordStrength().color">
              {{ getPasswordStrength().strength }}
            </span>
          </div>

          <!-- Confirm Password Field -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Confirm New Password</mat-label>
            <input matInput 
                   formControlName="confirmPassword" 
                   [type]="confirmPasswordInputType" 
                   placeholder="Confirm your new password"
                   autocomplete="new-password">
            <mat-icon matSuffix 
                      (click)="toggleConfirmPasswordVisibility()" 
                      class="password-toggle-icon">
              {{ confirmPasswordInputType === 'password' ? 'visibility' : 'visibility_off' }}
            </mat-icon>
            <mat-error *ngIf="resetPasswordForm.get('confirmPassword')?.hasError('required')">
              Please confirm your password
            </mat-error>
            <mat-error *ngIf="resetPasswordForm.hasError('passwordMismatch')">
              Passwords do not match
            </mat-error>
          </mat-form-field>

          <!-- Password Requirements -->
          <div class="password-requirements">
            <h4>Password Requirements:</h4>
            <ul>
              <li [class.valid]="isPasswordLengthValid()">
                At least 8 characters long
              </li>
              <li [class.valid]="hasUppercase()">
                One uppercase letter (A-Z)
              </li>
              <li [class.valid]="hasLowercase()">
                One lowercase letter (a-z)
              </li>
              <li [class.valid]="hasNumber()">
                One number (0-9)
              </li>
              <li [class.valid]="hasSpecialChar()">
                One special character (@$!%*?&)
              </li>
            </ul>
          </div>

          <!-- Action Buttons -->
          <div class="action-buttons" fxLayout="row" fxLayoutGap="16px" fxLayoutAlign="center center">
            <button mat-stroked-button 
                    type="button" 
                    (click)="backToLogin()"
                    [disabled]="isLoading"
                    class="back-button">
              <mat-icon>arrow_back</mat-icon>
              Back to Login
            </button>
            
            <button mat-raised-button 
                    type="submit" 
                    color="primary"
                    [disabled]="!resetPasswordForm.valid || isLoading"
                    class="reset-button">
              <mat-spinner diameter="20" *ngIf="isLoading"></mat-spinner>
              <mat-icon *ngIf="!isLoading">lock_reset</mat-icon>
              {{ isLoading ? 'Resetting...' : 'Reset Password' }}
            </button>
          </div>
        </form>
      </mat-card-content>
    </mat-card>
  </div>
</div>
